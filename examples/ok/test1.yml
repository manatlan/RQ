host: http://test

i: 77

mymethod: |
  return x * 23

scenar1:
  - GET: /test?json=[1,2,{"key":"val"}]
    doc: test
    tests:
      - $status == 200
      - len($) == 3
      - $[0] == 1
      - $[1] == 2
      - $[2].key == "val"

scenar2:

  - call: scenar1

  - GET: /test
    doc: test
    tests:
      - $status == 200
      
  - GET: /test?json={ "coco":"VAL" }
    doc: test
    tests:
      - $status == 200
      - $.coco == "VAL"
  - set:
       toto: <<$.coco>>

tata: 123

RUN:
  - set:
      toto: 42
      toti: <<10 * str(toto)>>
      KOKO: <<mymethod( 42 )>>

  - GET: /404
    doc: test NF
    tests:
      - $status == 404
      - $ == "Not Found"

  - call: scenar1
    params:
      - i: 1
      - i: 2
      - i: 3

  - set:
      HELLO: JE SUIS LA

  - call: scenar2

  - GET: /test?json=[<<mymethod(toto) * 3>>,<<j>>]
    doc: test
    tests:
      - $status == 200
      - $headers["content-type"] == "application/json"
      - $headers["content-TYPE"] == "application/json"
      - $[0] == 2898
      - $[1] == j
      - HELLO == "JE SUIS LA"
    params:
    - j: 1
    - j: 2
    - j: 3

  - set:
       lastStatus: <<$status>>

  